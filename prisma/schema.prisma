generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Store {
  id                 Int                 @id @default(autoincrement())
  ownerId            Int
  name               String
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  auditLogs          AuditLog[]
  cashDrawers        CashDrawer[]
  categories         Category[]
  customers          Customer[]
  employees          Employee[]
  notifications      Notification[]
  posSettings        POSSettings[]
  parkedSales        ParkedSale[]
  products           Product[]
  purchaseOrders     PurchaseOrder[]
  purchaseOrderItems PurchaseOrderItem[]
  quickSaleItems     QuickSaleItem[]
  sales              Sale[]
  saleItems          SaleItem[]
  stockAlerts        StockAlert[]
  stockMovements     StockMovement[]
  owner              Employee            @relation("StoreOwner", fields: [ownerId], references: [id])
  suppliers          Supplier[]
}

model Employee {
  id              Int           @id @default(autoincrement())
  storeId         Int?
  name            String
  username        String        @unique
  email           String?       @unique
  phone           String?
  photo           String?
  joinedDate      DateTime?
  salary          Float?
  contractDetails String?
  notes           String?
  pinCode         String
  role            String        @default("CASHIER")
  isActive        Boolean       @default(true)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  auditLogs       AuditLog[]
  CashDrawer      CashDrawer[]
  store           Store?        @relation(fields: [storeId], references: [id], onDelete: Cascade)
  posSettings     POSSettings[]
  parkedSales     ParkedSale[]
  salarySheets    SalarySheet[]
  sales           Sale[]
  storesOwned     Store[]       @relation("StoreOwner")
}

model SalarySheet {
  id         Int       @id @default(autoincrement())
  employeeId Int
  month      Int
  year       Int
  baseSalary Float
  bonus      Float?
  deduction  Float?
  paid       Boolean   @default(false)
  paidAt     DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  employee   Employee  @relation(fields: [employeeId], references: [id])
}

model AuditLog {
  id         Int       @id @default(autoincrement())
  storeId    Int
  employeeId Int?
  action     String
  entity     String?
  entityId   Int?
  details    String?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime  @default(now())
  employee   Employee? @relation(fields: [employeeId], references: [id])
  store      Store     @relation(fields: [storeId], references: [id], onDelete: Cascade)
}

model Category {
  id        Int       @id @default(autoincrement())
  storeId   Int
  name      String    @unique
  icon      String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  store     Store     @relation(fields: [storeId], references: [id], onDelete: Cascade)
  products  Product[]
}

model Supplier {
  id            Int             @id @default(autoincrement())
  storeId       Int
  name          String
  contactName   String?
  phone         String?
  email         String?         @unique
  address       String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  products      Product[]
  PurchaseOrder PurchaseOrder[]
  store         Store           @relation(fields: [storeId], references: [id], onDelete: Cascade)
}

model Product {
  id                Int                 @id @default(autoincrement())
  storeId           Int
  categoryId        Int
  supplierId        Int?
  name              String
  sku               String              @unique
  barcode           String?             @unique
  description       String?
  purchasePrice     Float
  sellingPrice      Float
  stockQuantity     Float               @default(0)
  lowStockThreshold Int                 @default(10)
  isWeighted        Boolean             @default(false)
  isActive          Boolean             @default(true)
  isDeleted         Boolean             @default(false)
  taxRate           Float               @default(0)
  image             String?
  unit              String?             @default("pcs")
  hasVariants       Boolean             @default(false)
  expiryDate        DateTime?
  lastSoldDate      DateTime?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  notifications     Notification[]
  category          Category            @relation(fields: [categoryId], references: [id])
  store             Store               @relation(fields: [storeId], references: [id], onDelete: Cascade)
  supplier          Supplier?           @relation(fields: [supplierId], references: [id])
  variants          ProductVariant[]
  PurchaseOrderItem PurchaseOrderItem[]
  quickSaleItems    QuickSaleItem[]
  saleItems         SaleItem[]
  stockAlerts       StockAlert[]
  stockMovements    StockMovement[]
}

model ProductVariant {
  id             Int             @id @default(autoincrement())
  productId      Int
  name           String
  sku            String          @unique
  barcode        String?         @unique
  purchasePrice  Float
  sellingPrice   Float
  stockQuantity  Float           @default(0)
  isActive       Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  product        Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  saleItems      SaleItem[]
  stockMovements StockMovement[]
}

model Sale {
  id                 Int                 @id @default(autoincrement())
  storeId            Int
  employeeId         Int
  customerId         Int?
  offerId            Int?
  receiptId          String              @unique
  subtotal           Float
  taxAmount          Float               @default(0)
  discountAmount     Float               @default(0)
  loyaltyDiscount    Float               @default(0)
  offerTitle         String?
  offerDiscount      Float?              @default(0)
  finalAmount        Float
  paymentMethod      String
  paymentStatus      String              @default("COMPLETED")
  cashReceived       Float?
  changeGiven        Float?
  notes              String?
  discountReason     String?
  pointsEarned       Int                 @default(0)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  paymentSplits      PaymentSplit[]
  pointsTransactions PointsTransaction[]
  customer           Customer?           @relation(fields: [customerId], references: [id])
  employee           Employee            @relation(fields: [employeeId], references: [id])
  store              Store               @relation(fields: [storeId], references: [id], onDelete: Cascade)
  saleItems          SaleItem[]
}

model SaleItem {
  id               Int             @id @default(autoincrement())
  saleId           Int
  productId        Int
  productVariantId Int?
  storeId          Int
  quantity         Float
  priceAtSale      Float
  discount         Float           @default(0)
  subtotal         Float
  product          Product         @relation(fields: [productId], references: [id])
  productVariant   ProductVariant? @relation(fields: [productVariantId], references: [id])
  sale             Sale            @relation(fields: [saleId], references: [id], onDelete: Cascade)
  store            Store           @relation(fields: [storeId], references: [id], onDelete: Cascade)
}

model PaymentSplit {
  id            Int      @id @default(autoincrement())
  saleId        Int
  paymentMethod String
  amount        Float
  createdAt     DateTime @default(now())
  sale          Sale     @relation(fields: [saleId], references: [id], onDelete: Cascade)
}

model Customer {
  id                 Int                 @id @default(autoincrement())
  storeId            Int
  name               String
  phoneNumber        String?             @unique
  email              String?             @unique
  loyaltyPoints      Int                 @default(0)
  loyaltyTier        String              @default("BRONZE")
  dateOfBirth        DateTime?
  address            String?
  isActive           Boolean             @default(true)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  store              Store               @relation(fields: [storeId], references: [id], onDelete: Cascade)
  loyaltyRewards     LoyaltyReward[]
  parkedSales        ParkedSale[]
  pointsTransactions PointsTransaction[]
  sales              Sale[]
}

model PointsTransaction {
  id          Int      @id @default(autoincrement())
  customerId  Int
  saleId      Int?
  type        String
  points      Int
  description String?
  createdAt   DateTime @default(now())
  customer    Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  sale        Sale?    @relation(fields: [saleId], references: [id])
}

model LoyaltyReward {
  id          Int       @id @default(autoincrement())
  customerId  Int
  rewardType  String
  rewardValue Float
  pointsCost  Int
  description String
  isActive    Boolean   @default(true)
  expiresAt   DateTime?
  redeemedAt  DateTime?
  createdAt   DateTime  @default(now())
  customer    Customer  @relation(fields: [customerId], references: [id], onDelete: Cascade)
}

model LoyaltyTierConfig {
  id                 Int     @id @default(autoincrement())
  tier               String  @unique
  minimumPoints      Int     @default(0)
  pointsMultiplier   Float   @default(1)
  discountPercentage Float   @default(0)
  birthdayBonus      Int     @default(0)
  description        String?
}

model LoyaltyOffer {
  id              Int      @id @default(autoincrement())
  title           String
  description     String
  offerType       String
  discountValue   Float?
  minimumPurchase Float    @default(0)
  requiredTier    String   @default("BRONZE")
  startDate       DateTime
  endDate         DateTime
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model PurchaseOrder {
  id           Int                 @id @default(autoincrement())
  supplierId   Int
  storeId      Int
  poNumber     String              @unique
  status       String              @default("PENDING")
  orderDate    DateTime            @default(now())
  expectedDate DateTime?
  receivedDate DateTime?
  totalAmount  Float               @default(0)
  notes        String?
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  store        Store               @relation(fields: [storeId], references: [id], onDelete: Cascade)
  supplier     Supplier            @relation(fields: [supplierId], references: [id])
  items        PurchaseOrderItem[]
}

model PurchaseOrderItem {
  id               Int           @id @default(autoincrement())
  purchaseOrderId  Int
  productId        Int
  storeId          Int
  quantity         Float
  unitCost         Float
  totalCost        Float
  receivedQuantity Float         @default(0)
  product          Product       @relation(fields: [productId], references: [id])
  purchaseOrder    PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  store            Store         @relation(fields: [storeId], references: [id], onDelete: Cascade)
}

model StockMovement {
  id               Int             @id @default(autoincrement())
  productId        Int
  productVariantId Int?
  storeId          Int
  createdBy        Int?
  movementType     String
  quantity         Float
  reason           String?
  reference        String?
  fromLocation     String?
  toLocation       String?
  createdAt        DateTime        @default(now())
  product          Product         @relation(fields: [productId], references: [id])
  productVariant   ProductVariant? @relation(fields: [productVariantId], references: [id])
  store            Store           @relation(fields: [storeId], references: [id], onDelete: Cascade)
}

model StockAlert {
  id         Int       @id @default(autoincrement())
  productId  Int
  storeId    Int
  alertType  String
  message    String
  isResolved Boolean   @default(false)
  resolvedAt DateTime?
  resolvedBy Int?
  createdAt  DateTime  @default(now())
  product    Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  store      Store     @relation(fields: [storeId], references: [id], onDelete: Cascade)
}

model POSSettings {
  id                              Int       @id @default(autoincrement())
  storeId                         Int
  updatedBy                       Int?
  systemErrorAlertEnabled         Boolean   @default(false)
  priceChangeAlertEnabled         Boolean   @default(false)
  enableQuickSale                 Boolean   @default(false)
  enableSplitPayment              Boolean   @default(true)
  enableParkSale                  Boolean   @default(true)
  enableCustomerSearch            Boolean   @default(true)
  enableBarcodeScanner            Boolean   @default(true)
  enableLoyaltyPoints             Boolean   @default(true)
  loyaltyPointsPerUnit            Float     @default(10)
  pointsRedemptionRate            Float     @default(100)
  storeName                       String    @default("POS System")
  storeAddress                    String    @default("Chatmohar, Pabna, Dhaka, Bangladesh")
  storePhone                      String    @default("+8801712345678")
  storeEmail                      String?   @unique
  taxId                           String?
  taxRate                         Float     @default(0)
  currencyCode                    String    @default("USD")
  currencySymbol                  String    @default("$")
  currencyPosition                String    @default("before")
  receiptFooterText               String?
  returnPolicy                    String?
  printReceiptAuto                Boolean   @default(false)
  autoPrintThermal                Boolean   @default(true)
  enableLowStockAlerts            Boolean   @default(true)
  lowStockThreshold               Int       @default(10)
  enableHighStockAlerts           Boolean   @default(false)
  highStockThreshold              Int       @default(1000)
  enableProductExpiryAlerts       Boolean   @default(false)
  productExpiryDays               Int       @default(7)
  supplierDeliveryAlertEnabled    Boolean   @default(false)
  expectedDeliveryDays            Int       @default(7)
  inactiveProductAlertEnabled     Boolean   @default(false)
  inactiveProductDays             Int       @default(30)
  lowBalanceAlertEnabled          Boolean   @default(false)
  lowBalanceThreshold             Float     @default(100)
  frequentRefundsAlertEnabled     Boolean   @default(false)
  frequentRefundsThreshold        Int       @default(3)
  autoLogoutMinutes               Int       @default(30)
  requirePasswordOnVoid           Boolean   @default(true)
  enableAuditLog                  Boolean   @default(true)
  productsPerPage                 Int       @default(20)
  defaultView                     String    @default("grid")
  showProductImages               Boolean   @default(true)
  dailySalesTargetAlertEnabled    Boolean   @default(false)
  dailySalesTargetAmount          Int       @default(1000)
  loyaltyPointsExpiryAlertEnabled Boolean   @default(false)
  loyaltyPointsExpiryDays         Int       @default(30)
  updatedAt                       DateTime  @updatedAt
  store                           Store     @relation(fields: [storeId], references: [id], onDelete: Cascade)
  updatedByEmployee               Employee? @relation(fields: [updatedBy], references: [id])
}

model CashDrawer {
  id              Int       @id @default(autoincrement())
  employeeId      Int
  storeId         Int
  openingBalance  Float
  closingBalance  Float?
  expectedBalance Float?
  difference      Float?
  status          String    @default("OPEN")
  openedAt        DateTime  @default(now())
  closedAt        DateTime?
  employee        Employee  @relation(fields: [employeeId], references: [id])
  store           Store     @relation(fields: [storeId], references: [id], onDelete: Cascade)
}

model ParkedSale {
  id             Int       @id @default(autoincrement())
  employeeId     Int
  customerId     Int?
  storeId        Int
  items          String
  subtotal       Float
  taxAmount      Float     @default(0)
  discountAmount Float     @default(0)
  notes          String?
  parkedAt       DateTime  @default(now())
  expiresAt      DateTime?
  customer       Customer? @relation(fields: [customerId], references: [id])
  employee       Employee  @relation(fields: [employeeId], references: [id])
  store          Store     @relation(fields: [storeId], references: [id], onDelete: Cascade)
}

model QuickSaleItem {
  id          Int     @id @default(autoincrement())
  productId   Int
  storeId     Int
  displayName String
  color       String  @default("#3B82F6")
  sortOrder   Int     @default(0)
  isActive    Boolean @default(true)
  product     Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  store       Store   @relation(fields: [storeId], references: [id], onDelete: Cascade)
}

model Notification {
  id        Int      @id @default(autoincrement())
  storeId   Int
  productId Int?
  type      String
  message   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  product   Product? @relation(fields: [productId], references: [id])
  store     Store    @relation(fields: [storeId], references: [id], onDelete: Cascade)
}
